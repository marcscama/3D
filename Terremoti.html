<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizzazione Terremoti 3D con Glance</title>

    <!-- Carica Glance -->
    <script src="https://cdn.jsdelivr.net/npm/@kitware/glance"></script>
    <!-- Carica PapaParse per il parsing del CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #glance-container {
            height: 100vh;
        }
    </style>
</head>
<body>
    <!-- Sezione per caricare il file CSV -->
    <div>
        <input type="file" id="csvFile" onchange="handleFileSelect(event)">
        <button onclick="clearViewer()">Pulisci Vista</button>
    </div>

    <!-- Contenitore per il visualizzatore Glance -->
    <div id="glance-container"></div>

    <script>
        // Inizializza il visualizzatore Glance
        const viewer = new Glance.Viewer('glance-container');

        // Funzione per caricare il file CSV
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                loadCSV(file);
            }
        }

        // Funzione per caricare e analizzare il CSV
        function loadCSV(file) {
            Papa.parse(file, {
                complete: function(results) {
                    const points = results.data.map(row => {
                        return {
                            x: parseFloat(row[0]),  // Coordinata X
                            y: parseFloat(row[1]),  // Coordinata Y
                            z: parseFloat(row[2]),  // Coordinata Z (profondità)
                            md: parseFloat(row[4])  // Magnitudo o profondità (se presente)
                        };
                    });

                    // Carica i punti 3D su Glance
                    loadModelFromCSV(points);
                }
            });
        }

        // Funzione per caricare i dati dei punti nel visualizzatore Glance
        function loadModelFromCSV(points) {
            // Crea un oggetto VTK in formato JSON da utilizzare con Glance
            const vtkData = {
                points: points.map(p => [p.x, p.y, p.z]), // Posizioni dei punti
                scalars: points.map(p => p.md || 0), // Magnitudo o altre informazioni
                pointData: {
                    scalarNames: ['Magnitude']
                }
            };

            // Carica i dati nel visualizzatore Glance
            viewer.loadModelFromData(vtkData);

            // Imposta la vista della camera per inquadrare i dati
            viewer.setCamera({
                position: [100, 100, 100],  // Posizione della camera
                target: [0, 0, 0]           // Obiettivo della camera
            });
        }

        // Funzione per pulire il visualizzatore
        function clearViewer() {
            viewer.clear();
        }
    </script>
</body>
</html>
